(async()=>{const t=new URLSearchParams(window.location.search).get("v");if(t){console.log(`Video ID: ${t}`);const e=`https://youtube-caption-api.vercel.app/caption/${t}`;try{const t=await fetch(e);if(!t.ok)return void alert(`Failed to fetch captions. Status: ${t.status}`);const o=await t.json();if(o.length>0){const t=Date.now(),e=await(async t=>{try{const e="https://youtube-caption-api.vercel.app/translate?lang=tamil",o=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({captions:t})});return o.ok?(await o.json()).translatedCaptions||t.map((t=>t.text)):(console.error(`Translation API error: ${o.status}`),t.map((t=>t.text)))}catch(e){return console.error("Error during translation:",e),t.map((t=>t.text))}})(o);o.forEach(((o,a)=>{let{offset:n,duration:r,speechRate:s}=o,c=e[a]||o.text;c=c.replace(/&amp;#39;/g,"'").replace(/\[Music\]/g,""),a<10&&console.log(c);const i=Math.min(300,Math.max(100,s));setTimeout((()=>{chrome.runtime.sendMessage({type:"speak",text:c,rate:i})}),t+1e3*n-Date.now())})),console.log("Captions scheduled for speech.")}else alert("No captions found for this video.")}catch(t){console.error("Error fetching captions:",t),alert("An error occurred while fetching captions.")}}else alert("No video ID found on this page."),console.error("No video ID found on this page.")})();